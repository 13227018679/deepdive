#!/usr/bin/env bash
# compile-sql_extractor -- Compiles given extractor specified in JSON into a form executable by DeepDive
set -eu

ExtractorName=$1; shift
ExtractorSpec=$1; shift

ExtractorName=$ExtractorName \
ExtractorStyle=${0##*compile-} \
jq -r <<<"$ExtractorSpec" >run.sh '
"#!/usr/bin/env bash
# \(env.ExtractorStyle)  \(env.ExtractorName)
# \(@json)
set -xeuo pipefail
cd \"$(dirname \"$0\")\"

\(.before // "")

deepdive sql \(.sql | @sh)

\(.after // "")
"
'
chmod +x run.sh
