#!/usr/bin/env bash
# update-master-image -- Rebuilds and publishes deepdive-build:master Docker image
##
set -euo pipefail
. "$(dirname "$0")"/config.bash

type docker
docker -v

cd "$DEEPDIVE_SOURCE_ROOT"
pwd
set -x

# build Docker image
docker build \
     --build-arg BRANCH=$(git rev-parse --abbrev-ref HEAD) \
     --label COMMIT=$(git rev-parse HEAD) \
     --tag "$DOCKER_IMAGE" \
     .

# and publish
docker push "$DOCKER_IMAGE"
